{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _createClass from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _inherits from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\src\\\\components\\\\ServiceProviderHome.js\";\nimport React, { Component } from 'react';\nimport './ServiceProviderHome.css';\nimport { Redirect } from \"react-router-dom\";\nimport Header from './Header';\nimport Footer from './Footer';\nimport Error from './Error';\nimport { loadState, saveToLocalStorage } from '../storage';\nimport { loadWeb3, loadBlockchainData } from '../loadBlockchain';\nimport $ from 'jquery';\n\nvar ServiceProviderHome = /*#__PURE__*/function (_Component) {\n  _inherits(ServiceProviderHome, _Component);\n\n  _createClass(ServiceProviderHome, [{\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _this2 = this;\n\n      // user click back on browser from showPatient home, \n      // so he move to serviveProviderHome and can't comeback to showPatient page \n      window.onpopstate = function (e) {\n        _this2.props.history.push('/ServiceProviderHome');\n      };\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var blockchain, state, newState;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return loadWeb3();\n\n              case 2:\n                _context.next = 4;\n                return loadBlockchainData();\n\n              case 4:\n                blockchain = _context.sent;\n\n                if (!(blockchain !== undefined || blockchain !== null)) {\n                  _context.next = 19;\n                  break;\n                }\n\n                this.permissions = blockchain.permissions; // save smart contruct\n\n                _context.next = 9;\n                return loadState();\n\n              case 9:\n                state = _context.sent;\n                newState = $.extend(this.state, state);\n                this.setState(newState);\n                state = $.extend(state, {\n                  patientAccount: '',\n                  patientPrivateKey: ''\n                });\n                _context.next = 15;\n                return saveToLocalStorage(state);\n\n              case 15:\n                this.setState({\n                  loading: false\n                }); // Authentication \n\n                if (this.state.serviceProvider === undefined || !this.state.serviceProvider) {\n                  this.props.history.push('/');\n                }\n\n                _context.next = 20;\n                break;\n\n              case 19:\n                this.props.history.push('/');\n\n              case 20:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }]);\n\n  function ServiceProviderHome(props) {\n    var _this;\n\n    _classCallCheck(this, ServiceProviderHome);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(ServiceProviderHome).call(this, props));\n    _this.state = {\n      patientAccount: '',\n      loading: true,\n      searchValue: '0x',\n      hasPermission: false,\n      hasError: false\n    };\n    _this.permissions = null;\n    _this.searchPatient = _this.searchPatient.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.checkPermission = _this.checkPermission.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.changeSearchHandle = _this.changeSearchHandle.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  } // check permission on blockchain\n\n\n  _createClass(ServiceProviderHome, [{\n    key: \"checkPermission\",\n    value: function () {\n      var _checkPermission = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(account) {\n        var check;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(account !== \"\" && account !== undefined)) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                _context2.next = 3;\n                return this.permissions.methods.havePermission(account).call({\n                  from: this.state.account\n                });\n\n              case 3:\n                check = _context2.sent;\n                return _context2.abrupt(\"return\", check);\n\n              case 5:\n                return _context2.abrupt(\"return\", false);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function checkPermission(_x) {\n        return _checkPermission.apply(this, arguments);\n      }\n\n      return checkPermission;\n    }() // on click search\n\n  }, {\n    key: \"searchPatient\",\n    value: function () {\n      var _searchPatient = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var search, check, state;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                search = this.state.searchValue; // check if have permission\n\n                if (!(search !== undefined && search !== '' && search.length === 42 && search.match('0x[a-fA-F0-9]{40}$'))) {\n                  _context3.next = 22;\n                  break;\n                }\n\n                this.setState({\n                  loading: true\n                });\n                _context3.next = 5;\n                return this.checkPermission(search);\n\n              case 5:\n                check = _context3.sent;\n\n                if (!check) {\n                  _context3.next = 17;\n                  break;\n                }\n\n                _context3.next = 9;\n                return loadState();\n\n              case 9:\n                state = _context3.sent;\n                // get the old state\n                state = $.extend(state, {\n                  patientAccount: search\n                }); // add patientAccount to the state\n\n                _context3.next = 13;\n                return saveToLocalStorage(state);\n\n              case 13:\n                this.setState({\n                  loading: false\n                });\n                this.setState({\n                  patientAccount: search,\n                  hasPermission: true\n                }); // move to show pateint mrc\n\n                _context3.next = 20;\n                break;\n\n              case 17:\n                window.alert(\"Sorry! you don't have permission!!\");\n                this.setState({\n                  loading: false,\n                  patientAccount: '',\n                  hasPermission: false\n                });\n                this.setState({\n                  searchValue: '0x'\n                });\n\n              case 20:\n                _context3.next = 25;\n                break;\n\n              case 22:\n                this.setState({\n                  loading: false,\n                  hasPermission: false\n                });\n                window.alert(\"Sorry! you entered incorrect account\");\n                this.setState({\n                  searchValue: '0x'\n                });\n\n              case 25:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function searchPatient() {\n        return _searchPatient.apply(this, arguments);\n      }\n\n      return searchPatient;\n    }() // value search change\n\n  }, {\n    key: \"changeSearchHandle\",\n    value: function changeSearchHandle(event) {\n      this.setState({\n        searchValue: event.target.value\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Error, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 17\n        }\n      }, this.state.loading ? /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 39\n        }\n      }, \"Loading.....\") : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Header, {\n        parent: true,\n        account: this.state.account,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 27\n        }\n      }), /*#__PURE__*/React.createElement(\"h4\", {\n        style: {\n          paddingLeft: \"40px\",\n          color: \"#ff9900\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110,\n          columnNumber: 17\n        }\n      }, \"Hello \", this.state.account), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"h5\", {\n        style: {\n          textAlign: \"center\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 19\n        }\n      }, \"Searching patient by address\"), /*#__PURE__*/React.createElement(\"div\", {\n        className: \"cover\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"divFrom\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"input\", {\n        type: \"search\",\n        id: \"searchInput\",\n        value: this.state.searchValue,\n        onChange: this.changeSearchHandle,\n        minLength: \"42\",\n        maxLength: \"42\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 27\n        }\n      }), /*#__PURE__*/React.createElement(\"i\", {\n        className: \"fa fa-search\",\n        onClick: this.searchPatient,\n        onTouchEnd: this.searchPatient,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 31\n        }\n      })))), this.state.hasPermission ? /*#__PURE__*/React.createElement(Redirect, {\n        push: true,\n        to: {\n          pathname: \"/ShowPatientMrc\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 19\n        }\n      }) : null, /*#__PURE__*/React.createElement(Footer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 15\n        }\n      }))));\n    }\n  }]);\n\n  return ServiceProviderHome;\n}(Component);\n\nexport default ServiceProviderHome;","map":{"version":3,"sources":["C:/Users/shaii/Desktop/projects/MrC/src/components/ServiceProviderHome.js"],"names":["React","Component","Redirect","Header","Footer","Error","loadState","saveToLocalStorage","loadWeb3","loadBlockchainData","$","ServiceProviderHome","window","onpopstate","e","props","history","push","blockchain","undefined","permissions","state","newState","extend","setState","patientAccount","patientPrivateKey","loading","serviceProvider","searchValue","hasPermission","hasError","searchPatient","bind","checkPermission","changeSearchHandle","account","methods","havePermission","call","from","check","search","length","match","alert","event","target","value","paddingLeft","color","textAlign","pathname"],"mappings":";;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAO,2BAAP;AACA,SAASC,QAAT,QAAwB,kBAAxB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,SAAQC,SAAR,EAAmBC,kBAAnB,QAA4C,YAA5C;AACA,SAAQC,QAAR,EAAkBC,kBAAlB,QAA2C,mBAA3C;AACA,OAAOC,CAAP,MAAc,QAAd;;IAGMC,mB;;;;;yCAEgB;AAAA;;AAClB;AACA;AACAC,MAAAA,MAAM,CAACC,UAAP,GAAqB,UAACC,CAAD,EAAO;AAC1B,QAAA,MAAI,CAACC,KAAL,CAAWC,OAAX,CAAmBC,IAAnB,CAAwB,sBAAxB;AACD,OAFD;AAGD;;;;;;;;;;;uBAGOT,QAAQ,E;;;;uBACWC,kBAAkB,E;;;AAArCS,gBAAAA,U;;sBACHA,UAAU,KAAKC,SAAf,IAA2BD,UAAU,KAAK,I;;;;;AAC3C,qBAAKE,WAAL,GAAmBF,UAAU,CAACE,WAA9B,C,CAA2C;;;uBACzBd,SAAS,E;;;AAAvBe,gBAAAA,K;AACEC,gBAAAA,Q,GAAWZ,CAAC,CAACa,MAAF,CAAS,KAAKF,KAAd,EAAoBA,KAApB,C;AACjB,qBAAKG,QAAL,CAAcF,QAAd;AACAD,gBAAAA,KAAK,GAAGX,CAAC,CAACa,MAAF,CAASF,KAAT,EAAgB;AAAEI,kBAAAA,cAAc,EAAC,EAAjB;AAAoBC,kBAAAA,iBAAiB,EAAC;AAAtC,iBAAhB,CAAR;;uBACMnB,kBAAkB,CAACc,KAAD,C;;;AACxB,qBAAKG,QAAL,CAAc;AAACG,kBAAAA,OAAO,EAAC;AAAT,iBAAd,E,CAEA;;AACA,oBAAG,KAAKN,KAAL,CAAWO,eAAX,KAA+BT,SAA/B,IAA4C,CAAC,KAAKE,KAAL,CAAWO,eAA3D,EAA2E;AACzE,uBAAKb,KAAL,CAAWC,OAAX,CAAmBC,IAAnB,CAAwB,GAAxB;AACD;;;;;;AAGD,qBAAKF,KAAL,CAAWC,OAAX,CAAmBC,IAAnB,CAAwB,GAAxB;;;;;;;;;;;;;;;;;;AAIJ,+BAAYF,KAAZ,EAAmB;AAAA;;AAAA;;AACf,6FAAMA,KAAN;AACA,UAAKM,KAAL,GAAa;AACXI,MAAAA,cAAc,EAAC,EADJ;AAEXE,MAAAA,OAAO,EAAC,IAFG;AAGXE,MAAAA,WAAW,EAAC,IAHD;AAIXC,MAAAA,aAAa,EAAC,KAJH;AAKXC,MAAAA,QAAQ,EAAE;AALC,KAAb;AAQA,UAAKX,WAAL,GAAmB,IAAnB;AACA,UAAKY,aAAL,GAAqB,MAAKA,aAAL,CAAmBC,IAAnB,uDAArB;AACA,UAAKC,eAAL,GAAuB,MAAKA,eAAL,CAAqBD,IAArB,uDAAvB;AACA,UAAKE,kBAAL,GAA0B,MAAKA,kBAAL,CAAwBF,IAAxB,uDAA1B;AAbe;AAclB,G,CACD;;;;;;wGACsBG,O;;;;;;sBACjBA,OAAO,KAAK,EAAZ,IAAkBA,OAAO,KAAKjB,S;;;;;;uBACV,KAAKC,WAAL,CAAiBiB,OAAjB,CAAyBC,cAAzB,CAAwCF,OAAxC,EACpBG,IADoB,CACf;AAACC,kBAAAA,IAAI,EAAC,KAAKnB,KAAL,CAAWe;AAAjB,iBADe,C;;;AAAfK,gBAAAA,K;kDAECA,K;;;kDAEF,K;;;;;;;;;;;;;;;QAET;;;;;;;;;;;AAEQC,gBAAAA,M,GAAS,KAAKrB,KAAL,CAAWQ,W,EAC1B;;sBACGa,MAAM,KAAKvB,SAAX,IAAwBuB,MAAM,KAAK,EAAnC,IACAA,MAAM,CAACC,MAAP,KAAkB,EADlB,IACwBD,MAAM,CAACE,KAAP,CAAa,oBAAb,C;;;;;AAEzB,qBAAKpB,QAAL,CAAc;AAAEG,kBAAAA,OAAO,EAAE;AAAX,iBAAd;;uBACoB,KAAKO,eAAL,CAAqBQ,MAArB,C;;;AAAdD,gBAAAA,K;;qBACHA,K;;;;;;uBACiBnC,SAAS,E;;;AAAvBe,gBAAAA,K;AAA0B;AAC9BA,gBAAAA,KAAK,GAAGX,CAAC,CAACa,MAAF,CAASF,KAAT,EAAe;AAACI,kBAAAA,cAAc,EAACiB;AAAhB,iBAAf,CAAR,C,CAAgD;;;uBAC1CnC,kBAAkB,CAACc,KAAD,C;;;AACxB,qBAAKG,QAAL,CAAc;AAAEG,kBAAAA,OAAO,EAAE;AAAX,iBAAd;AACA,qBAAKH,QAAL,CAAc;AAACC,kBAAAA,cAAc,EAACiB,MAAhB;AAAuBZ,kBAAAA,aAAa,EAAC;AAArC,iBAAd,E,CAA0D;;;;;;AAG1DlB,gBAAAA,MAAM,CAACiC,KAAP,CAAa,oCAAb;AACA,qBAAKrB,QAAL,CAAc;AAACG,kBAAAA,OAAO,EAAE,KAAV;AAAgBF,kBAAAA,cAAc,EAAC,EAA/B;AAAkCK,kBAAAA,aAAa,EAAC;AAAhD,iBAAd;AACA,qBAAKN,QAAL,CAAc;AAACK,kBAAAA,WAAW,EAAC;AAAb,iBAAd;;;;;;;AAIF,qBAAKL,QAAL,CAAc;AAACG,kBAAAA,OAAO,EAAE,KAAV;AAAgBG,kBAAAA,aAAa,EAAE;AAA/B,iBAAd;AACAlB,gBAAAA,MAAM,CAACiC,KAAP,CAAa,sCAAb;AACA,qBAAKrB,QAAL,CAAc;AAACK,kBAAAA,WAAW,EAAC;AAAb,iBAAd;;;;;;;;;;;;;;;QAIJ;;;;uCACmBiB,K,EAAM;AACvB,WAAKtB,QAAL,CAAc;AAACK,QAAAA,WAAW,EAACiB,KAAK,CAACC,MAAN,CAAaC;AAA1B,OAAd;AACD;;;6BAEU;AACL,0BACI,uDACI,oBAAC,KAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACC,KAAK3B,KAAL,CAAWM,OAAX,gBAAqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAArB,gBACD,uDACA,oBAAC,MAAD;AAAQ,QAAA,MAAM,EAAE,IAAhB;AAAsB,QAAA,OAAO,EAAE,KAAKN,KAAL,CAAWe,OAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADA,eAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFA,eAEK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFL,eAEU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFV,eAGA;AAAI,QAAA,KAAK,EAAE;AAACa,UAAAA,WAAW,EAAC,MAAb;AAAoBC,UAAAA,KAAK,EAAC;AAA1B,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAwD,KAAK7B,KAAL,CAAWe,OAAnE,CAHA,eAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAJA,eAIK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAJL,eAKF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACI;AAAI,QAAA,KAAK,EAAE;AAACe,UAAAA,SAAS,EAAE;AAAZ,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wCADJ,eAEI;AAAK,QAAA,SAAS,EAAC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACI;AAAK,QAAA,SAAS,EAAC,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBACI;AAAO,QAAA,IAAI,EAAC,QAAZ;AAAqB,QAAA,EAAE,EAAC,aAAxB;AAAsC,QAAA,KAAK,EAAE,KAAK9B,KAAL,CAAWQ,WAAxD;AACA,QAAA,QAAQ,EAAE,KAAKM,kBADf;AACmC,QAAA,SAAS,EAAC,IAD7C;AACkD,QAAA,SAAS,EAAC,IAD5D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADJ,eAIQ;AAAG,QAAA,SAAS,EAAC,cAAb;AACA,QAAA,OAAO,EAAE,KAAKH,aADd;AAEA,QAAA,UAAU,EAAE,KAAKA,aAFjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAJR,CADJ,CAFJ,CALE,EAkBG,KAAKX,KAAL,CAAWS,aAAX,gBAED,oBAAC,QAAD;AAAU,QAAA,IAAI,MAAd;AAAe,QAAA,EAAE,EAAE;AACjBsB,UAAAA,QAAQ,EAAE;AADO,SAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFC,GAKC,IAvBJ,eAwBF,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAxBE,CAFA,CADJ,CADJ;AAkCD;;;;EA7H2BnD,S;;AAgIlC,eAAeU,mBAAf","sourcesContent":["import React, { Component } from 'react'\nimport './ServiceProviderHome.css'\nimport { Redirect} from \"react-router-dom\";\nimport Header from './Header';\nimport Footer from './Footer'\nimport Error from './Error'\nimport {loadState, saveToLocalStorage} from '../storage'\nimport {loadWeb3, loadBlockchainData} from '../loadBlockchain'\nimport $ from 'jquery'\n\n\nclass ServiceProviderHome extends Component{\n  \n  componentDidUpdate(){\n    // user click back on browser from showPatient home, \n    // so he move to serviveProviderHome and can't comeback to showPatient page \n    window.onpopstate  = (e) => { \n      this.props.history.push('/ServiceProviderHome')\n    }      \n  }\n  async componentDidMount() {\n    // loading blockchain\n    await loadWeb3();\n    const blockchain = await loadBlockchainData();\n    if(blockchain !== undefined ||blockchain !== null){\n      this.permissions = blockchain.permissions; // save smart contruct\n      let state = await loadState();\n      const newState = $.extend(this.state,state);\n      this.setState(newState);\n      state = $.extend(state, { patientAccount:'',patientPrivateKey:''});\n      await saveToLocalStorage(state);\n      this.setState({loading:false});\n\n      // Authentication \n      if(this.state.serviceProvider === undefined || !this.state.serviceProvider){\n        this.props.history.push('/');\n      }\n    }\n    else{\n      this.props.history.push('/');\n    }\n  }\n\n  constructor(props) {\n      super(props)\n      this.state = {\n        patientAccount:'',\n        loading:true,\n        searchValue:'0x',\n        hasPermission:false,\n        hasError: false\n      }\n     \n      this.permissions = null\n      this.searchPatient = this.searchPatient.bind(this)\n      this.checkPermission = this.checkPermission.bind(this)\n      this.changeSearchHandle = this.changeSearchHandle.bind(this)\n  }\n  // check permission on blockchain\n  async checkPermission(account){\n    if(account !== \"\" && account !== undefined){       \n      const check  = await this.permissions.methods.havePermission(account)\n      .call({from:this.state.account})\n      return check \n    }\n    return false;\n  }\n  // on click search\n  async searchPatient(){\n    const search = this.state.searchValue\n    // check if have permission\n    if(search !== undefined && search !== '' \n    && search.length === 42 && search.match('0x[a-fA-F0-9]{40}$')){\n      \n      this.setState({ loading: true }) \n      const check = await this.checkPermission(search)\n      if(check){\n        let state = await loadState() // get the old state\n        state = $.extend(state,{patientAccount:search}) // add patientAccount to the state\n        await saveToLocalStorage(state)\n        this.setState({ loading: false })  \n        this.setState({patientAccount:search,hasPermission:true}) // move to show pateint mrc\n      }\n      else{\n        window.alert(\"Sorry! you don't have permission!!\")\n        this.setState({loading: false,patientAccount:'',hasPermission:false})\n        this.setState({searchValue:'0x'}) \n      }\n    }\n    else{\n      this.setState({loading: false,hasPermission: false })\n      window.alert(\"Sorry! you entered incorrect account\")\n      this.setState({searchValue:'0x'}) \n    }\n  }\n\n  // value search change\n  changeSearchHandle(event){\n    this.setState({searchValue:event.target.value})\n  }\n\n    render() {\n        return(\n            <>\n                <Error>\n                {this.state.loading ? <div>Loading.....</div> :\n                <>\n                <Header parent={true} account={this.state.account}/>\n                <br/><br/><br/>\n                <h4 style={{paddingLeft:\"40px\",color:\"#ff9900\"}}>Hello {this.state.account}</h4>\n                <br/><br/>\n              <div>\n                  <h5 style={{textAlign: \"center\"}}>Searching patient by address</h5>\n                  <div className=\"cover\">\n                      <div className=\"divFrom\" >     \n                          <input type=\"search\" id=\"searchInput\" value={this.state.searchValue} \n                          onChange={this.changeSearchHandle} minLength=\"42\" maxLength=\"42\" \n                          />\n                              <i className=\"fa fa-search\"  \n                              onClick={this.searchPatient}\n                              onTouchEnd={this.searchPatient} ></i>\n                      </div>\n                  </div>\n                </div>\n                  {this.state.hasPermission \n                  ?  \n                  <Redirect push to={{\n                    pathname: \"/ShowPatientMrc\"\n                  }} />          \n                  : null}\n              <Footer/>\n              </>\n              }\n              </Error>\n              </>\n          );\n      }\n}\n\nexport default ServiceProviderHome;"]},"metadata":{},"sourceType":"module"}