{"ast":null,"code":"import _slicedToArray from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";\nimport _createClass from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _inherits from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"C:\\\\Users\\\\shaii\\\\Desktop\\\\projects\\\\MrC\\\\src\\\\components\\\\PatientHome.js\";\nimport React, { Component, useState } from 'react';\nimport Footer from './Footer';\nimport Header from './Header';\nimport Form from 'react-bootstrap/Form';\nimport Modal from 'react-bootstrap/Modal';\nimport Button from 'react-bootstrap/Button';\nimport Mrc from './Mrc';\nimport Error from './Error';\nimport deleteIcon from '../images/delete_icon.jpg';\nimport { loadState } from '../storage';\nimport { loadWeb3, loadBlockchainData } from '../loadBlockchain';\nimport $ from 'jquery';\n\nvar PatientHome = /*#__PURE__*/function (_Component) {\n  _inherits(PatientHome, _Component);\n\n  _createClass(PatientHome, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var blockchain, blockchainData, state, newState;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return loadWeb3();\n\n              case 2:\n                blockchain = _context.sent;\n\n                if (!(blockchain !== null)) {\n                  _context.next = 20;\n                  break;\n                }\n\n                _context.next = 6;\n                return loadBlockchainData();\n\n              case 6:\n                blockchainData = _context.sent;\n\n                if (!(blockchainData !== undefined || blockchainData !== null)) {\n                  _context.next = 19;\n                  break;\n                }\n\n                this.permissions = blockchainData.permissions; // save smart contruct\n\n                _context.next = 11;\n                return loadState();\n\n              case 11:\n                state = _context.sent;\n                newState = $.extend(this.state, state);\n                this.setState(newState);\n                _context.next = 16;\n                return this.loadingMrC();\n\n              case 16:\n                this.setState({\n                  loading: false\n                });\n                _context.next = 20;\n                break;\n\n              case 19:\n                this.props.history.push('/');\n\n              case 20:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"loadingMrC\",\n    value: function () {\n      var _loadingMrC = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var accessList, mrc;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.permissions.methods.getServiceProviderPermissions().call({\n                  \"from\": this.state.account\n                });\n\n              case 2:\n                accessList = _context2.sent;\n                this.setState({\n                  accessList: accessList\n                }); // get the mrc of this patient\n\n                _context2.next = 6;\n                return this.permissions.methods.getMrc(this.state.account).call({\n                  from: this.state.account\n                });\n\n              case 6:\n                mrc = _context2.sent;\n                this.setState({\n                  mrc: mrc\n                });\n                this.setState({\n                  loading: false\n                });\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function loadingMrC() {\n        return _loadingMrC.apply(this, arguments);\n      }\n\n      return loadingMrC;\n    }()\n  }]);\n\n  function PatientHome(props) {\n    var _this;\n\n    _classCallCheck(this, PatientHome);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(PatientHome).call(this, props));\n    _this.state = {\n      loading: true\n    };\n    _this.permissions = null;\n    _this.removeAccess = _this.removeAccess.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.loadingMrC = _this.loadingMrC.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(PatientHome, [{\n    key: \"addAccessToServiceProvider\",\n    value: function () {\n      var _addAccessToServiceProvider = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(address) {\n        var _this2 = this;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this.setState({\n                  loading: true\n                });\n                this.permissions.methods.giveAccessToServiceProvider(address).send({\n                  from: this.state.account\n                }).once('error', function (error) {\n                  _this2.setState({\n                    hasError: true\n                  });\n                }).once('confirmation', function (confirmation) {\n                  _this2.loadingMrC(); // update mrc\n\n\n                  _this2.setState({\n                    loading: false\n                  });\n                });\n\n              case 2:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function addAccessToServiceProvider(_x) {\n        return _addAccessToServiceProvider.apply(this, arguments);\n      }\n\n      return addAccessToServiceProvider;\n    }()\n  }, {\n    key: \"removeAccess\",\n    value: function () {\n      var _removeAccess = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(address) {\n        var _this3 = this;\n\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                // revoke this address\n                this.setState({\n                  loading: true\n                });\n                this.permissions.methods.revokeAccessFromDoctor(address).send({\n                  from: this.state.account,\n                  gas: 0\n                }).once('error', function (error) {\n                  _this3.setState({\n                    hasError: true\n                  });\n                }).once('confirmation', function (confirmation) {\n                  _this3.loadingMrC(); // update mrc\n\n\n                  _this3.setState({\n                    loading: false\n                  });\n                });\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function removeAccess(_x2) {\n        return _removeAccess.apply(this, arguments);\n      }\n\n      return removeAccess;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Error, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 13\n        }\n      }, this.state.loading ? /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 39\n        }\n      }, \"Loading.....\") : /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Header, {\n        parent: false,\n        account: this.state.account,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 27\n        }\n      }), /*#__PURE__*/React.createElement(\"h4\", {\n        style: {\n          paddingLeft: \"40px\",\n          color: \"#ff9900\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 17\n        }\n      }, \"Hello \", this.state.account), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(Mrc, {\n        accountShow: this.state.account,\n        mrc: this.state.mrc,\n        accountKey: this.state.privateKey,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          padding: \"40px\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"h4\", {\n        style: {\n          borderBottom: '5px solid',\n          borderBottomColor: '#ff9900'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 21\n        }\n      }, \"Access to service providers\"), /*#__PURE__*/React.createElement(AccessToServiceProvider, {\n        parent: this,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 17\n        }\n      }), this.state.accessList !== undefined && this.state.accessList !== null ? this.state.accessList.map(function (access) {\n        return /*#__PURE__*/React.createElement(\"div\", {\n          __self: _this4,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 28\n          }\n        }, /*#__PURE__*/React.createElement(\"b\", {\n          key: access,\n          __self: _this4,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 31\n          }\n        }, access.toString(), /*#__PURE__*/React.createElement(\"span\", {\n          __self: _this4,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 66\n          }\n        }, \"    \"), /*#__PURE__*/React.createElement(\"img\", {\n          src: deleteIcon,\n          width: \"20px\",\n          height: \"20px\",\n          onClick: function onClick() {\n            return _this4.removeAccess(access);\n          },\n          alt: \"\",\n          __self: _this4,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 31\n          }\n        })), /*#__PURE__*/React.createElement(\"br\", {\n          __self: _this4,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 105,\n            columnNumber: 31\n          }\n        }));\n      }) : null), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 17\n        }\n      }), /*#__PURE__*/React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 22\n        }\n      }), /*#__PURE__*/React.createElement(Footer, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 17\n        }\n      }))));\n    }\n  }]);\n\n  return PatientHome;\n}(Component);\n\nfunction AccessToServiceProvider(props) {\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      show = _useState2[0],\n      setShow = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      state = _useState4[0],\n      setState = _useState4[1];\n\n  var handleShow = function handleShow() {\n    setShow(true);\n    setState(\"\");\n  };\n\n  var handleSubmit = function handleSubmit(event) {\n    event.preventDefault(); // check state\n\n    if (state !== undefined && state !== \"\") {\n      setShow(false);\n      props.parent.addAccessToServiceProvider(state);\n    }\n\n    setState(\"\");\n  };\n\n  var handleChange = function handleChange(event) {\n    setState(event.target.value);\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n    style: {\n      color: \"blue\"\n    },\n    onClick: handleShow,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 7\n    }\n  }, \"Add a new access\"), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Modal, {\n    show: show,\n    onHide: function onHide() {\n      return setShow(false);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    method: \"GET\",\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 11\n    }\n  }, \"Add access\")), /*#__PURE__*/React.createElement(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Form.Control, {\n    value: state,\n    onChange: handleChange,\n    type: \"text\",\n    placeholder: \"Enter address\",\n    required: true,\n    pattern: \"0x[a-fA-F0-9]{40}$\",\n    onInvalid: function onInvalid(event) {\n      return event.target.setCustomValidity(\"Accout address is incorrect!\");\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    variant: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 11\n    }\n  }, \"Save Changes\")))));\n}\n\nexport default PatientHome;","map":{"version":3,"sources":["C:/Users/shaii/Desktop/projects/MrC/src/components/PatientHome.js"],"names":["React","Component","useState","Footer","Header","Form","Modal","Button","Mrc","Error","deleteIcon","loadState","loadWeb3","loadBlockchainData","$","PatientHome","blockchain","blockchainData","undefined","permissions","state","newState","extend","setState","loadingMrC","loading","props","history","push","methods","getServiceProviderPermissions","call","account","accessList","getMrc","from","mrc","removeAccess","bind","address","giveAccessToServiceProvider","send","once","error","hasError","confirmation","revokeAccessFromDoctor","gas","paddingLeft","color","privateKey","padding","borderBottom","borderBottomColor","map","access","toString","AccessToServiceProvider","show","setShow","handleShow","handleSubmit","event","preventDefault","parent","addAccessToServiceProvider","handleChange","target","value","setCustomValidity"],"mappings":"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","sourcesContent":["import React, { Component,useState } from 'react';\nimport Footer from './Footer';\nimport Header from './Header';\nimport Form from 'react-bootstrap/Form';\nimport Modal from 'react-bootstrap/Modal';\nimport Button from 'react-bootstrap/Button';\nimport Mrc from './Mrc';\nimport Error from './Error';\nimport deleteIcon from '../images/delete_icon.jpg';\nimport { loadState } from '../storage';\nimport { loadWeb3, loadBlockchainData } from '../loadBlockchain';\nimport $ from 'jquery';\n\nclass PatientHome extends Component{\n  \n  async componentDidMount() {\n    // loading blockchain \n    const blockchain = await loadWeb3();\n    if(blockchain !== null){\n      const blockchainData = await loadBlockchainData();\n      if(blockchainData !== undefined ||blockchainData !== null){\n        this.permissions = blockchainData.permissions; // save smart contruct\n        let state = await loadState();\n        const newState = $.extend(this.state,state);\n        this.setState(newState);\n        await this.loadingMrC();\n        this.setState({loading:false});\n      }\n      else{\n        this.props.history.push('/');\n      }\n    }\n  }\n  \n  async loadingMrC(){\n    // get all service providers have permission\n    const accessList = await this.permissions.methods.getServiceProviderPermissions().call({\"from\":this.state.account});\n    this.setState({accessList});\n    // get the mrc of this patient\n    const mrc = await this.permissions.methods.getMrc(this.state.account).call({from:this.state.account});\n    this.setState({mrc});\n    this.setState({loading:false});\n  }\n   \n    constructor(props) {\n        super(props);\n        this.state = {\n          loading:true\n        };\n        this.permissions = null;\n        this.removeAccess = this.removeAccess.bind(this);\n        this.loadingMrC = this.loadingMrC.bind(this);\n    }\n\n    async addAccessToServiceProvider(address){\n        this.setState({ loading: true });\n        this.permissions.methods.giveAccessToServiceProvider(address)\n        .send({from:this.state.account})\n        .once('error', (error) => {\n            this.setState({ hasError: true })\n        })\n        .once('confirmation', (confirmation) => {\n            this.loadingMrC() // update mrc\n            this.setState({ loading: false })\n        });   \n    }\n    async removeAccess(address){\n        // revoke this address\n        this.setState({ loading: true });\n        this.permissions.methods.revokeAccessFromDoctor(address)\n        .send({from:this.state.account,gas:0})\n        .once('error', (error) => {\n            this.setState({ hasError: true })\n        })\n        .once('confirmation', (confirmation) => {\n            this.loadingMrC() // update mrc\n            this.setState({ loading: false })\n        });\n    }\n\n    render(){\n        return(\n            <>\n            <Error > \n                {this.state.loading ? <div>Loading.....</div> \n                :\n                <>               \n                <Header parent={false} account={this.state.account}/>\n                <br/><br/><br/>\n                <h4 style={{paddingLeft:\"40px\",color:\"#ff9900\"}}>Hello {this.state.account}</h4>\n                <br/>\n                <Mrc accountShow={this.state.account} mrc= {this.state.mrc} accountKey= {this.state.privateKey}/>\n                \n                <div style={{padding:\"40px\"}}>\n                    <h4 style={{borderBottom: '5px solid', borderBottomColor:'#ff9900'}}>\n                      Access to service providers</h4>\n                    <AccessToServiceProvider parent={this} />\n                <br/>\n                { this.state.accessList !== undefined && this.state.accessList !== null ?\n                    this.state.accessList.map(access =>{\n                        return (\n                           <div>\n                              <b key={access}>{access.toString()}<span>    </span> \n                              <img src={deleteIcon} width=\"20px\" height=\"20px\"  onClick={() => this.removeAccess(access)} alt=\"\"/></b>\n                              <br/>\n                           </div>\n                              ) \n                    })\n                    : null\n                }\n                </div>\n                <br/><br/>\n                <Footer />\n                </>\n                }\n            </Error>\n            </>\n        );\n    }\n}\n\nfunction AccessToServiceProvider(props) {\n  const [show, setShow] = useState(false);\n  const [state,setState] = useState(\"\");\n\n  const handleShow = () => {\n    setShow(true);\n    setState(\"\");\n  }\n  const handleSubmit = (event) =>{\n    event.preventDefault();\n    // check state\n    if(state !== undefined && state !== \"\"){\n      setShow(false);\n      props.parent.addAccessToServiceProvider(state);\n    }\n    setState(\"\");\n  }\n  const handleChange = (event) =>{\n    setState(event.target.value);\n  }\n\n  return (\n    <>\n      <span style={{color:\"blue\"}} onClick={handleShow}>\n        Add a new access\n      </span>\n      <br/>\n      <Modal show={show} onHide={() => setShow(false)} >\n        <Form method='GET' onSubmit={handleSubmit}>\n        <Modal.Header closeButton>\n          <Modal.Title>Add access</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n            <Form.Control value={state} onChange={handleChange} type=\"text\" \n             placeholder=\"Enter address\" required pattern=\"0x[a-fA-F0-9]{40}$\"\n             onInvalid={(event) =>  event.target.setCustomValidity(\"Accout address is incorrect!\")}/>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button type=\"submit\"  variant=\"primary\">\n            Save Changes\n          </Button>\n        </Modal.Footer>\n        </Form>\n      </Modal>\n    </>\n  );\n}\nexport default PatientHome;\n"]},"metadata":{},"sourceType":"module"}